# GitHub Actions Workflows

æœ¬ç›®å½•åŒ…å«é¡¹ç›®çš„ GitHub Actions å·¥ä½œæµé…ç½®ã€‚

## ğŸ“‹ å·¥ä½œæµæ¦‚è§ˆ

| Workflow | è§¦å‘æ¡ä»¶ | çŠ¶æ€ | ç”¨é€” |
|----------|---------|------|------|
| [docs.yml](docs.yml) | Push to `main` (docs/\*\*) | âœ… å¯ç”¨ | éƒ¨ç½²æ–‡æ¡£åˆ° GitHub Pages |
| [preview.yml](preview.yml) | Pull Request | âœ… å¯ç”¨ | PR é¢„è§ˆæ„å»º |
| [hugo.yml](hugo.yml) | Manual only | â¸ï¸ ç¦ç”¨ | Hugo ç«™ç‚¹éƒ¨ç½²ï¼ˆå·²è¿ç§»åˆ° Vercelï¼‰|

## ğŸ”„ å·¥ä½œæµè¯¦æƒ…

### 1. Deploy Documentation to GitHub Pages (`docs.yml`)

**ç”¨é€”**: è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®æ–‡æ¡£åˆ° GitHub Pages

**è§¦å‘æ¡ä»¶**:
- Push åˆ° `main` åˆ†æ”¯
- ä¿®æ”¹äº† `docs/**` æˆ– `scripts/README.md`
- æ‰‹åŠ¨è§¦å‘

**éƒ¨ç½²ç›®æ ‡**: https://songshgeo.github.io/SongshGeo-as-Scholar/

**å·¥ä½œæµç¨‹**:
1. æ£€å‡ºä»£ç 
2. å¤åˆ¶ `docs/` å†…å®¹åˆ° `_site/`
3. å¤åˆ¶ `scripts/README.md` åˆ° `_site/scripts/`
4. ä¸Šä¼ æ„å»ºäº§ç‰©
5. éƒ¨ç½²åˆ° GitHub Pages

**æ³¨æ„äº‹é¡¹**:
- âœ… åªåœ¨ `main` åˆ†æ”¯éƒ¨ç½²ï¼ˆé¿å…ç¯å¢ƒä¿æŠ¤è§„åˆ™å†²çªï¼‰
- âœ… ä½¿ç”¨ Docsify æ¸²æŸ“æ–‡æ¡£
- âœ… æ”¯æŒå…¨æ–‡æœç´¢
- âš ï¸ é¦–æ¬¡ä½¿ç”¨éœ€è¦åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­å¯ç”¨ Pagesï¼ˆSettings â†’ Pages â†’ Source: GitHub Actionsï¼‰

**æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€**: [Actions æ ‡ç­¾é¡µ](https://github.com/SongshGeo/SongshGeo-as-Scholar/actions/workflows/docs.yml)

---

### 2. Preview PR (`preview.yml`)

**ç”¨é€”**: ä¸º Pull Request æ„å»ºé¢„è§ˆç‰ˆæœ¬ï¼ŒéªŒè¯æ„å»ºæˆåŠŸ

**è§¦å‘æ¡ä»¶**:
- åˆ›å»ºæˆ–æ›´æ–° PRï¼ˆç›®æ ‡åˆ†æ”¯ä¸º `main` æˆ– `dev`ï¼‰

**å·¥ä½œæµç¨‹**:
1. å®‰è£… Hugo å’Œä¾èµ–
2. æ„å»ºç½‘ç«™ï¼ˆåŒ…å«è‰ç¨¿å’Œæœªæ¥å‘å¸ƒçš„å†…å®¹ï¼‰
3. åœ¨ PR ä¸­å‘å¸ƒæ„å»ºçŠ¶æ€è¯„è®º

**æƒé™**:
- `contents: read` - è¯»å–ä»“åº“ä»£ç 
- `pull-requests: write` - åœ¨ PR ä¸­åˆ›å»ºè¯„è®º

**æ³¨æ„äº‹é¡¹**:
- âœ… åªæ„å»ºä¸éƒ¨ç½²ï¼ˆå¿«é€ŸéªŒè¯ï¼‰
- âœ… ä½¿ç”¨å¼€å‘ç¯å¢ƒé…ç½®
- âœ… åŒ…å«è‰ç¨¿å†…å®¹é¢„è§ˆ
- âš ï¸ éœ€è¦ `pull-requests: write` æƒé™

**æŸ¥çœ‹è¿è¡Œå†å²**: [Actions æ ‡ç­¾é¡µ](https://github.com/SongshGeo/SongshGeo-as-Scholar/actions/workflows/preview.yml)

---

### 3. Deploy Hugo site to Pages (`hugo.yml`) - å·²ç¦ç”¨

**çŠ¶æ€**: â¸ï¸ **å·²ç¦ç”¨** - ä¸»ç«™é€šè¿‡ Vercel éƒ¨ç½²

**åŸå› **: 
- ä¸»ç«™å·²è¿ç§»åˆ° Vercel è¿›è¡Œè‡ªåŠ¨éƒ¨ç½²
- é¿å…ä¸æ–‡æ¡£éƒ¨ç½²å†²çªï¼ˆéƒ½ä½¿ç”¨ GitHub Pagesï¼‰
- Vercel æä¾›æ›´å¥½çš„é¢„è§ˆå’Œå›æ»šåŠŸèƒ½

**å¦‚ä½•é‡æ–°å¯ç”¨**:
1. å¦‚æœéœ€è¦å›åˆ° GitHub Pages éƒ¨ç½²ä¸»ç«™
2. ç¼–è¾‘ `hugo.yml`ï¼Œå–æ¶ˆæ³¨é‡Š `push` è§¦å‘å™¨
3. ç¦ç”¨æˆ–ä¿®æ”¹ `docs.yml`ï¼ˆé¿å…å†²çªï¼‰
4. åœ¨ GitHub è®¾ç½®ä¸­é…ç½® Pages ç¯å¢ƒ

**åŸå§‹åŠŸèƒ½**:
- æ„å»º Hugo ç½‘ç«™
- éƒ¨ç½²åˆ° GitHub Pages
- æ”¯æŒ `main` åˆ†æ”¯éƒ¨ç½²

---

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒä¿æŠ¤è§„åˆ™

GitHub Pages ç¯å¢ƒé»˜è®¤åªå…è®¸ `main` åˆ†æ”¯éƒ¨ç½²ã€‚å¦‚æœéœ€è¦ä»å…¶ä»–åˆ†æ”¯éƒ¨ç½²ï¼š

1. è¿›å…¥ä»“åº“ Settings â†’ Environments â†’ github-pages
2. ä¿®æ”¹ Deployment branches è§„åˆ™
3. æ·»åŠ å…è®¸çš„åˆ†æ”¯ï¼ˆå¦‚ `dev`ï¼‰

**å½“å‰é…ç½®**: åªå…è®¸ `main` åˆ†æ”¯éƒ¨ç½²ï¼ˆæ¨èï¼‰

### Concurrency æ§åˆ¶

æ–‡æ¡£éƒ¨ç½² workflow ä½¿ç”¨ `group: "pages"` æ¥ç¡®ä¿ï¼š
- åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªéƒ¨ç½²ä»»åŠ¡è¿è¡Œ
- é¿å…å¤šä¸ªéƒ¨ç½²ä»»åŠ¡å†²çª
- æ—§çš„æ’é˜Ÿä»»åŠ¡ä¼šè¢«å–æ¶ˆ

### æƒé™è¯´æ˜

| æƒé™ | ç”¨é€” | ä½¿ç”¨çš„ workflow |
|------|------|----------------|
| `contents: read` | è¯»å–ä»“åº“ä»£ç  | æ‰€æœ‰ |
| `pages: write` | éƒ¨ç½²åˆ° GitHub Pages | docs.yml |
| `id-token: write` | GitHub Pages è®¤è¯ | docs.yml |
| `pull-requests: write` | åœ¨ PR ä¸­è¯„è®º | preview.yml |

## ğŸ› å¸¸è§é—®é¢˜

### Q: "Branch 'dev' is not allowed to deploy to github-pages"

**A**: è¿™æ˜¯æ­£å¸¸çš„ç¯å¢ƒä¿æŠ¤è§„åˆ™ã€‚ç°åœ¨ `docs.yml` å·²ä¿®æ”¹ä¸ºåªåœ¨ `main` åˆ†æ”¯éƒ¨ç½²ï¼Œä¸ä¼šå†å‡ºç°æ­¤é”™è¯¯ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å·²ä¿®æ”¹ `docs.yml` åªç›‘å¬ `main` åˆ†æ”¯
- âœ… å·²ç¦ç”¨ `hugo.yml` è‡ªåŠ¨è§¦å‘

### Q: "Restore cache failed: Dependencies file is not found (go.sum)"

**A**: Go ä¾èµ–ç¼“å­˜å¤±è´¥ï¼Œä½†ä¸å½±å“æ„å»ºã€‚

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å·²æ·»åŠ  `cache: false` ç¦ç”¨ Go ç¼“å­˜
- æˆ–è€…åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ `go mod tidy` ç”Ÿæˆ `go.sum`

### Q: "Resource not accessible by integration" (preview.yml)

**A**: PR è¯„è®ºéœ€è¦ `pull-requests: write` æƒé™ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å·²æ·»åŠ  `pull-requests: write` æƒé™åˆ° `preview.yml`

### Q: ä¸¤ä¸ª workflow åŒæ—¶éƒ¨ç½²åˆ° GitHub Pages å†²çª

**A**: å¤šä¸ª workflow ä½¿ç”¨ç›¸åŒçš„ concurrency group ä¼šå†²çªã€‚

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å·²ç¦ç”¨ `hugo.yml` è‡ªåŠ¨éƒ¨ç½²ï¼ˆä¸»ç«™ç”¨ Vercelï¼‰
- âœ… `docs.yml` åªåœ¨ `main` åˆ†æ”¯éƒ¨ç½²æ–‡æ¡£
- æ˜ç¡®èŒè´£åˆ†å·¥ï¼šVercel éƒ¨ç½²ä¸»ç«™ï¼ŒGitHub Pages éƒ¨ç½²æ–‡æ¡£

## ğŸ“Š éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä»£ç æ¨é€                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                           â”‚
             â–¼                           â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   Push to   â”‚            â”‚  Pull        â”‚
      â”‚  main/dev   â”‚            â”‚  Request     â”‚
      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                 â–¼
    â”‚                 â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼                 â–¼          â”‚ preview.yml â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  (æ„å»º+è¯„è®º) â”‚
â”‚ Vercel  â”‚    â”‚ docs.yml â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ (ä¸»ç«™)  â”‚    â”‚ (main)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚               â”‚
    â”‚               â–¼
    â”‚        GitHub Pages
    â”‚      (æ–‡æ¡£ç«™ç‚¹)
    â”‚
    â–¼
Production
(yoursite.com)
```

## ğŸ”„ å·¥ä½œæµç¨‹æ¨è

### å¼€å‘æ–°åŠŸèƒ½

```bash
# 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-feature

# 2. å¼€å‘å¹¶æäº¤
git add .
git commit -m "feat: add new feature"

# 3. æ¨é€å¹¶åˆ›å»º PR
git push origin feature/new-feature

# 4. PR è‡ªåŠ¨è§¦å‘ preview.yml æ„å»ºéªŒè¯
#    æŸ¥çœ‹ PR è¯„è®ºä¸­çš„æ„å»ºçŠ¶æ€

# 5. åˆå¹¶åˆ° dev åˆ†æ”¯æµ‹è¯•
git checkout dev
git merge feature/new-feature

# 6. Vercel è‡ªåŠ¨éƒ¨ç½²é¢„è§ˆç¯å¢ƒ
```

### å‘å¸ƒåˆ°ç”Ÿäº§

```bash
# 1. ä» dev åˆ›å»º PR åˆ° main
git checkout dev
gh pr create --base main --title "Release v1.0.0"

# 2. å®¡æŸ¥å¹¶åˆå¹¶ PR

# 3. è‡ªåŠ¨è§¦å‘ï¼š
#    - docs.yml â†’ æ–‡æ¡£éƒ¨ç½²åˆ° GitHub Pages
#    - Vercel â†’ ä¸»ç«™éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
```

### æ›´æ–°æ–‡æ¡£

```bash
# 1. ç¼–è¾‘æ–‡æ¡£
vim docs/SOME_DOC.md

# 2. æäº¤åˆ° main åˆ†æ”¯
git add docs/
git commit -m "docs: update documentation"
git push origin main

# 3. docs.yml è‡ªåŠ¨éƒ¨ç½²æ–‡æ¡£
#    è®¿é—® https://songshgeo.github.io/SongshGeo-as-Scholar/
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [GitHub Pages é…ç½®](https://docs.github.com/en/pages)
- [Vercel éƒ¨ç½²æŒ‡å—](https://vercel.com/docs)
- [é¡¹ç›®æ–‡æ¡£å‘å¸ƒæŒ‡å—](../../docs/DOCS_DEPLOYMENT.md)

## ğŸ’¡ æœ€ä½³å®è·µ

1. **èŒè´£åˆ†ç¦»**: 
   - Vercel è´Ÿè´£ä¸»ç«™éƒ¨ç½²ï¼ˆæ”¯æŒé¢„è§ˆã€å›æ»šï¼‰
   - GitHub Pages è´Ÿè´£æ–‡æ¡£ç«™ç‚¹

2. **ç¯å¢ƒç®¡ç†**:
   - `main` åˆ†æ”¯ â†’ ç”Ÿäº§ç¯å¢ƒ
   - `dev` åˆ†æ”¯ â†’ å¼€å‘/æµ‹è¯•ç¯å¢ƒ
   - PR â†’ é¢„è§ˆæ„å»º

3. **å‡å°‘å†²çª**:
   - é¿å…å¤šä¸ª workflow éƒ¨ç½²åˆ°åŒä¸€ç›®æ ‡
   - ä½¿ç”¨ concurrency æ§åˆ¶å¹¶å‘éƒ¨ç½²
   - æ˜ç¡®åˆ†æ”¯éƒ¨ç½²è§„åˆ™

4. **å®‰å…¨æ€§**:
   - æœ€å°æƒé™åŸåˆ™ï¼ˆåªæˆäºˆå¿…éœ€çš„æƒé™ï¼‰
   - ä½¿ç”¨ç¯å¢ƒä¿æŠ¤è§„åˆ™
   - å®šæœŸå®¡æŸ¥ workflow é…ç½®

---

**æœ€åæ›´æ–°**: 2025-10-19

